version: v1.0
name: Test MyApp
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Install Deps
    task:
      jobs:
        - name: pnpm install
          commands:
            - 'cache restore node-modules-$SEMAPHORE_GIT_BRANCH-$(checksum package-lock.json),node-modules-$SEMAPHORE_GIT_BRANCH,node-modules-master'
            - pnpm install
            - cache store node-modules-$SEMAPHORE_GIT_BRANCH-$(checksum package-lock.json) node_modules
      prologue:
        commands:
          - checkout
          - sem-version node 12
          - 'curl -L https://unpkg.com/@pnpm/self-installer | node'
    dependencies: []
  - name: Cleanliness Check
    dependencies:
      - Install Deps
    task:
      jobs:
        - name: check-lint
          commands:
            - 'cache restore node-modules-$SEMAPHORE_GIT_BRANCH-$(checksum package-lock.json),node-modules-$SEMAPHORE_GIT_BRANCH,node-modules-master'
            - pnpm check-lint
        - name: check-pretty
          commands:
            - 'cache restore node-modules-$SEMAPHORE_GIT_BRANCH-$(checksum package-lock.json),node-modules-$SEMAPHORE_GIT_BRANCH,node-modules-master'
            - pnpm check-pretty
      prologue:
        commands:
          - checkout
          - sem-version node 12
          - 'curl -L https://unpkg.com/@pnpm/self-installer | node'
